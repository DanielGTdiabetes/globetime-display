[Service]
Environment=DISPLAY=:0
Environment=XAUTHORITY=/var/lib/pantalla-reloj/.Xauthority
Environment=GDK_BACKEND=x11
Environment=WEBKIT_DISABLE_DMABUF_RENDERER=1
Environment=GTK_USE_PORTAL=0
Environment=GIO_USE_PORTALS=0

# Matar Epiphany preexistente (sin regex anclado que falla)
ExecStartPre=/bin/sh -lc 'pkill -u %U -x epiphany-browser 2>/dev/null || true'
ExecStartPre=/bin/sh -lc 'pkill -u %U -f "/usr/bin/epiphany-browser" 2>/dev/null || true'

# Geometr√≠a robusta con reintento (480x1920 rotado a la izquierda)
ExecStartPre=/bin/sh -lc 'xrandr --fb 1920x1920 || true; sleep 0.2'
ExecStartPre=/bin/sh -lc 'xrandr --output HDMI-1 --rotate normal || true; sleep 0.2'
ExecStartPre=/bin/sh -lc 'xset -dpms; xset s off; xset s noblank || true'
ExecStartPre=/bin/sh -lc 'xrandr --output HDMI-1 --mode 480x1920 --primary --pos 0x0 || true; sleep 0.2'
ExecStartPre=/bin/sh -lc 'xrandr --output HDMI-1 --rotate left || true; sleep 0.2'
ExecStartPre=/bin/sh -lc 'xrandr --fb 480x1920 || true; sleep 0.2'
ExecStartPre=/bin/sh -lc 'xrandr --output HDMI-1 --mode 480x1920 --rotate left --primary --pos 0x0 || true'

# Sustituye el ExecStart: NO usar --application-mode (evita dependencia de portals)
ExecStart=
ExecStart=/usr/bin/epiphany-browser --new-window --start-fullscreen http://127.0.0.1
